
sccan --imageset-to-matrix [list.txt,$mask ] -o stats/thick.mhd
fi
echo eigenanatomy
 sccan --sparse-svd [stats/thick.mhd,$mask,-0.02] -o SPCA.nii.gz --PClusterThresh 2000 -i 20 -n 20 
# first label the eigenanatomy
 ls template/NIHPDtemplate_labels_low.nii > projlist.txt 
 ls SPCA*nii.gz >> projlist.txt 
 sccan --imageset-to-matrix [projlist.txt, $mask ] -o stats/labels.csv
 Rscript ~/code/sccan/scripts/label_eigenanatomy.R template/label_names.csv stats/labels.csv EigenAnatDescriptors.csv
# now render eigenanatomy
 gunzip SPCA*nii.gz
 ls SPCA*nii > projlist.txt 
 Rscript ~/code/sccan/scripts/render_eigenanatomy.R template/NIHPDtemplate_brainmask_small.nii projlist.txt EIGANAT 
 gzip SPCA*nii
labs=(` seq -w 0 100 `)
labim=temp.nii.gz 
MultiplyImages 3 $mask 0 $labim
ct=0
echo "label_num,label_name" > graphlabels.csv
for x in $(seq 0 20 ) ; do 
  let ct=$ct+1
  labnum=${labs[$x]}
  img=SPCAView1vec${labnum}.nii.gz
#  ImageMath 3 $img abs $img
#  ThresholdImage 3 $img temp2.nii.gz 1.e-9 9999
#  MultiplyImages 3 temp2.nii.gz $ct temp2.nii.gz
#  ImageMath 3 temp.nii.gz addtozero temp.nii.gz temp2.nii.gz
#  echo $ct $img
  echo "$ct,$img" >> graphlabels.csv
done
ImageMath 3 graphs.csv ROIStatistics graphlabels.csv temp.nii.gz
# template/NIHPDtemplate_labels_low.nii 
Rscript ~/code/sccan/scripts/graph_eigenanatomy.R graphs.csv SPCAprojectionsView1vec.csv EAnatGraphs

# ls SPCA*nii.gz > list_projections.txt
# sccan --imageset-to-projections [list_projections.txt,list.txt,1] -o SPCAprojectionsView1vec.csv 
# sccan --sparse-svd [stats/thick.mhd,$mask,0.9] -o EigenAnat.nii.gz --PClusterThresh 200 -i 50 -n 50
#

